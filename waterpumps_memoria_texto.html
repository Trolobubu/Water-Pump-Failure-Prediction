<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Waterpumps — Machine Learning Project (Geo + TopN + HGB)</title>
<meta name="description" content="Memoria del proyecto Waterpumps en formato HTML dinámico.">
<style>
:root{
  --bg:#ffffff;
  --panel:#f8fafc;
  --text:#0f172a;
  --muted:#475569;
  --accent:#1e3a8a; /* azul oscuro */
  --accent-2:#3b82f6; /* acento */
  --radius:16px;
  --shadow:0 10px 28px rgba(2,6,23,.08);
  --border:#e5e7eb;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.7}
.header{
  padding:36px 20px;border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,#ffffff, #f7fbff);
}
.wrap{max-width:1000px;margin:0 auto;padding:0 20px}
h1{margin:0 0 8px 0;font-size:2rem;color:var(--accent)}
h2{font-size:1.25rem;color:var(--accent);margin:0 0 10px 0}
p{margin:12px 0}
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin:18px 0}
details{border:1px solid var(--border);border-radius:14px;padding:12px 16px;background:#fff}
details summary{cursor:pointer;font-weight:600;color:var(--accent)}
.nav{position:sticky;top:0;background:#ffffffeb;border-bottom:1px solid var(--border)}
.nav .wrap{display:flex;gap:16px;align-items:center;overflow:auto}
.nav a{padding:12px 10px;color:var(--muted);text-decoration:none;border-bottom:2px solid transparent;white-space:nowrap}
.nav a.active{color:var(--accent);border-color:var(--accent-2)}
.footer{color:var(--muted);text-align:center;margin:28px 0}
</style>
</head>
<body>
<header class="header">
  <div class="wrap">
    <h1>Waterpumps — Machine Learning Project (Geo + TopN + HGB)</h1>
    <div class="muted">Technical report</div>
  </div>
</header>
<nav class="nav">
  <div class="wrap">
    <a href="#Summary" class="active">Summary</a>
    <a href="#contents">Contents</a>
  </div>
</nav>
<main class="wrap">
<section id="Summary" class="card">
  <h2>Resumen</h2>
  <p>Este documento recoge el contenido textual de la memoria del proyecto Waterpumps en un formato web ligero. Se ha mantenido únicamente el texto extraído del PDF original, presentado en secciones legibles con un diseño blanco y acentos azules.</p>
</section>
<section id="contents" class="card">
  <h2>Contenido</h2>
<p>1</p>
<p>MODULE :  Machine Learning
Waterpumps — Model Report (Geo + TopN Categ + HGB denso)
</p>
<p>2</p>
<p>CONTENTS
1. Objective of the Project
  
2. Available Data

3. Metric and Imbalance

4. Feature Engineering

5. Preprocessing

6. Model

7. Validation and Results

8. Experiment History

9. Conclusions</p>
<p>3</p>
<p>1. <p><strong>Objective of the Project</strong><br>
The goal of this project is to predict the operational status of each water point in Tanzania:
• functional  
• non functional  
• functional needs repair  

The deliverable includes:  
1. A reproducible pipeline in Python (scikit-learn).  
2. A detailed explanation of the applied feature engineering.  
3. The submission file with predictions for the test set.</p>

<p><strong>2. Available Data</strong><br>
Three CSV files were used:  
• train_features.csv: predictor variables for the training set.  
• labels.csv: training labels (status_group).  
• test_features.csv: predictor variables for the test set (without labels).  

Restrictions: no external data or additional APIs were used, following the competition rules.</p>

<p><strong>3. Metric and Imbalance</strong><br>
The official metric is Macro-F1, which computes the unweighted average of the F1-score for each class.  
This is important because the dataset is imbalanced: the “non functional” class is the majority compared to “functional needs repair.”  

To mitigate this imbalance, the following were applied:  
• class_weight='balanced' in the classifier.</p>

<p>• Computation of sample_weight by class, based on its frequency in the training set.</p>

<p><strong>4. Feature Engineering</strong><br>
Transformations were designed to provide additional information to the model:  

• <em>Temporal</em>  
  o rec_year, rec_month, rec_dayofweek extracted from date_recorded.  

• <em>Well age</em>  
  o well_age = rec_year - construction_year, with corrections for null or erroneous values (construction_year=0).  
  o Creation of discrete intervals (bins) to capture nonlinearities in age.  

• <em>Geographical</em>  
  o Flags such as gps_is_zero and height_is_zero to detect missing or invalid coordinates.  
  o Coarse binning of latitude/longitude (lat_bin, lon_bin) to capture broad regional patterns.  

• <em>Geo clustering</em>  
  o KMeans applied on (longitude, latitude, gps_height) combining train and test.  
  o Number of clusters: K ≈ 35.  
  o New categorical variable _geo_cluster representing regional membership.  

• <em>Scaling transformations</em>  
  o log_population and log_amount_tsh to stabilize highly skewed distributions.  
  o Ratio tsh_per_capita = amount_tsh / (population+1) to capture available water per person.</p>

<p><strong>5. Preprocessing</strong><br>
A ColumnTransformer was used to process different variable types separately:  

• <em>Numerical</em>  
  o Imputation with median.  
  o Scaling with StandardScaler (dense).  

• <em>Low-cardinality categorical</em>  
  o Imputation with mode.  
  o OneHotEncoder with dense representation.  

• <em>High-cardinality categorical</em>  
  o Application of a TopN reducer: keep the N most frequent categories (threshold: at least 30 occurrences).  
  o The rest grouped into the category “other.”  
  o OneHotEncoder (dense) applied afterward.  

• <em>Noise exclusion</em>  
  o Free-text columns with too much granularity were excluded: wpt_name, scheme_name, recorded_by, subvillage.</p>

<p><strong>6. Model</strong><br>
The selected classifier was <em>HistGradientBoostingClassifier (HGB)</em>, because it:  
• Captures nonlinear interactions between variables.  
• Natively supports dense scaled/one-hot encoded variables.  
• Implements early stopping to prevent overfitting.  

Key hyperparameters:  
• learning_rate=0.12  
• max_depth=12  
• max_iter=400  
• validation_fraction=0.1  
• n_iter_no_change=30  
• l2_regularization=1e-3</p>

<p><strong>7. Validation and Results</strong><br>
A holdout validation was performed (80% train / 20% stratified validation).  
• Reference metric: Macro-F1 ≈ 0.74–0.75 on the validation set.  
• The classification report shows that the model maintains a good balance between classes, although the minority class (“functional needs repair”) remains the most difficult.  

In the public leaderboard of the competition, the best achieved score was:  
0.7494 (Macro-F1)</p>

<p><strong>8. Experiment History</strong><br>
During development, 8 model variants were tested.  
The last five public scores were:</p>

<p><strong>9. Conclusions</strong><br>
• The combination of geographical and temporal feature engineering with a model robust to nonlinear interactions was key to improving performance.  
• The handling of categorical variables with TopNCategoryReducer allowed leveraging high-cardinality variables without overloading dimensionality.  
• The achieved score (0.7494 Macro-F1) ranks among the best attainable solutions without resorting to more complex models (ensembles or neural networks).  

This pipeline is reproducible, interpretable, and robust, providing a solid foundation for further improvements such as:  
• Ensembles of multiple classifiers (voting/blending).  
• Hyperparameter optimization via Optuna or BayesianSearch.  
• Inclusion of additional nonlinear interactions between numerical variables.</p>
</section>
<div class="footer">© <span id="y"></span> · Judith Martínez</div>
</main>
<script>
document.getElementById('y').textContent = new Date().getFullYear();

// marcar enlace activo al hacer scroll
const links=[...document.querySelectorAll('.nav a')];
const sections=[...document.querySelectorAll('main section')];
const onScroll=()=>{
  let cur=sections[0].id;
  sections.forEach(s=>{const r=s.getBoundingClientRect(); if(r.top<120) cur=s.id;});
  links.forEach(a=>a.classList.toggle('active', a.getAttribute('href')==='#'+cur));
};
document.addEventListener('scroll', onScroll);
</script>
</body></html>
